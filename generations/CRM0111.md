---
erp.entity: Crm.Sales.SalesOrders
erp.type: generation
---

# CRM0111 Create Service agreements

## Basic Information

| Module                          | Crm.Sales                                                    |
| :------------------------------ | ------------------------------------------------------------ |
| Code                            | CRM0111                                                      |
| Parent Document                 | Sales Order                                                  |
| Sub-document                    | Service agreement                                            |
| Full Name                       | Create Service agreements                                    |
| Status                          | [NEW](xref:generation-procedures)                            |
| Deterministic                   | [YES](xref:document-generation-and-transitional-documents)   |
| Supports Transitional Documents | [NO](xref:document-generation-and-transitional-documents)    |
| Replaces                        | GenerateServiceAgreement                                     |
| Orphan Rows                     | Ignore                                                       |
| Split Function                  |                                                              |
| Introduced In Version           |                                                              |
| Date of Suspension              | -                                                            |

##  Business Logic
This generation creates Service agreements only for those types of products, which are defined as serviced, but non-stocked.
A new Service object is created for each product and it is saved in the Service agreement lines. 
Generations from Store transactions are used for all other products, which are serviced.

The generation works only if there is a service type that is marked as default. Otherwise, it throws an error for missing default service type.
Also the generation works only if the field Guarantee Period Days has a value. Otherwise, it throws an error for the missing values.

## [Metrics](../reference/metrics.md)
No metrics are used. A new sub-document is created each time the generation starts, regardless of those already created in previous starts.

#### The Service Agreement header is created from the Sales Order header as follows:
```
ServiceAgreement.Customer = SalesOrder.Customer
ServiceAgreement.StartDateTime = Today
```
For each sales order with a product, that is defined as serviced, but non-stocked, one service object and one service agreement line are created in the sub-document:

```
ServiceObject.Product = SalesOrderLine.Product
ServiceObject.SerialNumber = SalesOrderLine.SerialNumber
ServiceObject.ServiceObjectName = SalesOrderLine.Product.ProductName
ServiceObject.Notes = SalesOrder.DisplayText
ServiceObject.EnterpriseCompany = ServiceAgreement.EnterpriseCompany

ServiceAgreementLine.LineNo = SalesOrderLine.LineNo
ServiceAgreementLine.ServiceObject = ServiceObject
ServiceAgreementLine.Quantity = SalesOrderLine.Quantity
ServiceAgreementLine.LineStartDateTime = Today
ServiceAgreementLine.LineEndDateTime = Today + SalesOrderLine.GuaranteePeriodDays
ServiceAgreementLine.ServiceType = ServiceType
ServiceAgreementLine.ParentLineNo = SalesOrderLine.LineNo
```
> [!Note]
> The created service agreement is saved only if there is at least one line in it.
