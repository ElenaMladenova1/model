---
erp.entity: Logistics.Procurement.PurchaseInvoices
erp.type: generation
---

# FIN0204 Create VAT sales entries

## Basic Information

| Module                          | Logistics.Procurement                                      |
| :------------------------------ | ---------------------------------------------------------- |
| Code                            | FIN0204                                                    |
| Parent Document                 | PurchaseInvoices                                           |
| Sub-document                    | VAT.Entries                                                |
| Full Name                       | Create VAT sales ledger entries                            |
| Status                          | [ACTIVE](xref:generation-procedures)                       |
| Deterministic                   | [YES](xref:document-generation-and-transitional-documents) |
| Supports Transitional Documents | [NO](xref:document-generation-and-transitional-documents)  |
| Replaces                        | GenerateSalesEntry; GenerateSalesEntrySkipNote             |
| Orphan Rows                     | Forbid                                                     |
| Introduced In Version           | 2022                                                       |
| Date of Suspension              | -                                                          |

## Business Logic

The generation is used for creating records in VAT Entry for Sales. These records contain VAT Amount and VAT Base Amount from current PurchaseInvoice, divided by Deals Types wich are in document. These records are used for creating data for VAT Declaration for this document for the reporting period.

The PurchaseInvoiceLine amounts are created for each DealType from distributed amount for current line for VATDocumentAmountType, grouped by LineDealType. It will be used these auxiliary variables:

> VATDocumentAmountType = PurchaseInvoices.EnterpriseCompany.VATDocumentAmountType
> 
> VATDocumentAmountCurrency = IIF(PurchaseInvoicesDocumentAmounts.InputAmountCurrency is not Null, PurchaseInvoice.DocumentAmounts.InputAmountCurrency Where PurchaseInvoices.DocumentAmounts.DocumentAmountType = VATDocumentAmountType, PurchaseInvoices.DocumentCurrency)
>
> SaleDealTypeAmount = SUM (PurchaseInvoices.DocumentDistributedAmount/Amount) WHERE DocumentLineId = PurchaseInvoiceLine DocumentAmountType=VATDocumentAmountType Group By SaleLineDealType
>
> SaleDealTypeBaseAmount = SUM (PurchaseInvoice.DocumentDistributedAmount/BaseAmount) WHERE DocumentLineId = PurchaseInvoiceLine DocumentAmountType=VATDocumentAmountType Group By SaleLineDealType
>
> VATSaleDealType = PurchaseInvoiceLine.LineDealType Group By SaleLineDealType - it is same which is used for grouping in SaleDealTypeAmount and SaleDealTypeBaseAmount.



The Document table attributes are filled in as described in [Standard Document Attributes](../reference/standard-document-attributes.md).

## Fulfillments

| Name                     | InvoiceLineToVATEnrty                                        |
| :----------------------- | ------------------------------------------------------------ |
| Parent Entity            | PurchaseInvoiceLine                                          |
| Child Entity             | VAT.Entry                                                    |
| Parent / Child Relations | Entry.ParentDocument = PurchaseInvoice; Entry.DealType = DealType; Entry.RegistrationVATNumber = PurchaseInvoice.Supplier.RegistrationVATNumber, Entry.RegistrationNumber = PurchaseInvoice.Supplier.RegistrationNumber, VATEntry.ApplyDate = PurchaseInvoice.ApplyDate |

## [Metrics](../reference/metrics.md)

| Fulfillment Name              |  Metric Name  |     Measurement Unit      | Parent Value           | Child Value         | New Record |
| :---------------------------- | :-----------: | :-----------------------: | :--------------------- | :------------------ | :--------- |
| PurchaseInvoiceLineToVATEnrty |  AmountBase   | VATDocumentAmountCurrency | SaleDealTypeAmount     | Entry.AmountBase    | YES        |
| PurchaseInvoiceLineToVATEnrty | VATAmountBase | VATDocumentAmountCurrency | SaleDealTypeBaseAmount | Entry.VATAmountBase | YES        |

if PurchaseInvoice.ReferenceDate.HasValue then
    Entry.DocumentDate = PurchaseInvoice.ReferenceDate else Entry.DocumentDate = PurchaseInvoice.DocumentDate

Entry.EntryType = Sales

Entry.DealType = VATSaleDealType

Entry.Party = PurchaseInvoice.Supplier.Party

If Invoice.Supplier.Party.PartyType = Company then Entry.RegistrationVATNumber = PurchaseInvoice.Supplier.RegistrationVATNumber

if (PurchaseInvoice.Supplier.RegistrationNumber.HasValue and PurchaseInvoice.Supplier.Party.PartyType = Company) then
    Entry.RegistrationNumber = PurchaseInvoice.Supplier.RegistrationNumber

if PurchaseInvoice.Supplier.Party.PartyType = Person   then Entry.RegistrationNumber   = PurchaseInvoice.Supplier.Party.Person.NationalNumber

Entry.ReferencedDocumentNo = 
    if PurchaseInvoice.ReferenceDocumentNo.HasValue then
        PurchaseInvoice.ReferenceDocumentNo
    else PurchaseInvoice.DocumentNo

Entry.ReferencedDocumentNo = PurchaseInvoice.DocumentNo

Entry.AmountBase = Remaining(AmountBase)

Entry.VATAmountBase = Remaining(VATAmountBase)

Entry.ApplyDate = PurchaseInvoice.ApplyDate

Entry.CashReportingMode = PurchaseInvoice.VATCashReportingMode

if Invoice.VATNotes.HasValue then
    VATEntry.Notes = PurchaseInvoice.VATNotes
    Else If  Entry.EnterpriseCompany is Bulgaria then VATEntry.Notes = "Самоначисляване на ДДС."



RegistrationVATNumber, RegistrationNumber  And VATNotes can be null if there is no value for them.
